<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>State Matcher</title>
  <style>
    .match {
      margin: 5px 0;
    }
    .match.correct {
      background-color: lightgreen;
    }
    .match.incorrect {
      background-color: lightcoral;
    }
    .match span {
      display: inline-block;
      width: 20px;
      text-align: center;
    }
    .input-field {
      width: 30px;
      text-align: center;
      margin: 2px;
    }
    .row {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

<h2>State Matcher</h2>

<!-- File upload for CSV -->
<input type="file" id="csv-upload" accept=".csv" onchange="readCSV()">
<h3>Enter State Values:</h3>
<div id="state-inputs">
  <!-- Dynamically generated input fields will appear here -->
</div>

<h3>Active Combinations (Matches)</h3>
<div id="matches"></div>

<script>
  let activeCombinations = [];  // Array to hold the imported active combinations

  // Function to read and process the CSV file
  function readCSV() {
    const fileInput = document.getElementById("csv-upload");
    const file = fileInput.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(event) {
        const contents = event.target.result;
        parseCSV(contents);
      };
      reader.readAsText(file);
    }
  }

  // Function to parse CSV and update activeCombinations array
  function parseCSV(csv) {
    const rows = csv.split('\n');
    activeCombinations = rows.map(row => row.split(';').map(cell => cell.trim().toUpperCase()));
    generateInputs();
  }

  // Normalize the input and predefined combinations (trim whitespace and convert to uppercase)
  function normalizeState(state) {
    return state.trim().toUpperCase();
  }

  // A function to compare the input state with each active combination
  function compareStates(inputState) {
    const results = [];
    activeCombinations.forEach((combination, index) => {
      let matches = 0;
      inputState.forEach((state, i) => {
        // If the input state is empty, it matches any value (wildcard behavior)
        if (state === '' || normalizeState(state) === normalizeState(combination[i])) {
          matches++;
        }
      });
      if (matches >= 10) {  // Only consider combinations with 10 or more matches
        results.push({ combination: combination.join(''), matches });
      }
    });
    return results;
  }

  // Function to update the matches displayed on the page
  function updateMatches() {
    const inputState = [];
    for (let i = 1; i <= 13; i++) {
      const state = document.getElementById(`state-${i}`).value.trim();
      inputState.push(state);
    }

    const matches = compareStates(inputState);

    // Clear previous matches
    const matchesDiv = document.getElementById('matches');
    matchesDiv.innerHTML = '';

    // Display new matches
    matches.sort((a, b) => b.matches - a.matches); // Sort matches by most matches
    matches.forEach((match) => {
      const matchDiv = document.createElement('div');
      matchDiv.classList.add('match');
      matchDiv.classList.add(match.matches === 13 ? 'correct' : 'incorrect');
      matchDiv.innerHTML = `Combination: ${match.combination} | Matches: ${match.matches}`;
      matchesDiv.appendChild(matchDiv);
    });
  }

  // Function to generate state input fields dynamically (1 to 13)
  function generateInputs() {
    const stateInputsDiv = document.getElementById('state-inputs');
    stateInputsDiv.innerHTML = '';  // Clear any existing input fields

    // Create input fields for states 1 to 13
    for (let i = 1; i <= 13; i++) {
      const rowDiv = document.createElement('div');
      rowDiv.classList.add('row');
      const label = document.createElement('label');
      label.textContent = `State ${i}: `;
      const inputField = document.createElement('input');
      inputField.classList.add('input-field');
      inputField.type = 'text';
      inputField.id = `state-${i}`;
      inputField.maxLength = 1;
      inputField.addEventListener('input', updateMatches);  // Recalculate matches on input change
      rowDiv.appendChild(label);
      rowDiv.appendChild(inputField);
      stateInputsDiv.appendChild(rowDiv);
    }
  }

  // Initialize the match display and inputs when the page loads
  function init() {
    generateInputs();  // Generate input fields
  }

  init();  // Call initialization function on page load
</script>

</body>
</html>
