<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veikkaus Status</title>
    <style>
        .hidden {
            display: none;
        }

        .highlight {
            background-color: red;
        }

        .matches {
            font-weight: bold;
        }

        .results {
            margin-top: 20px;
        }

        .state-input {
            width: 40px;
            margin: 3px;
            text-align: center;
        }

        .state-row {
            display: flex;
            flex-direction: column;
            margin-bottom: 5px;
        }

        .state-cell {
            width: 35px;
            text-align: center;
            padding: 7px;
        }

        .state-cell.highlight {
            background-color: red;
        }

        .match-count {
            font-size: 1.2em;
            font-weight: bold;
            margin-top: 10px;
        }

        .match-row {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin-bottom: 5px;
        }

        .match-column {
            flex: 1;
        }

        .label {
            font-weight: bold;
        }

        .input-section {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .input-fields {
            width: 60%;
        }

        .match-results {
            width: 35%;
            display: flex;
            flex-direction: column;
        }

        .state-input-row {
            margin-bottom: 5px;
        }

        .state-input-row input {
            width: 40px;
            text-align: center;
        }

        .state-input-row label {
            margin-right: 10px;
        }

        .state-row .state-cell {
            margin-right: 3px;
        }

        .match-count {
            margin-top: 10px;
        }

    </style>
</head>
<body>
    <h1>Veikkaus Status</h1>

    <div class="input-section">
        <!-- Input fields for 13 states -->
        <div class="input-fields">
            <h3>Enter the current status (1, X, 2) for each match:</h3>
            <div id="input-fields">
                <!-- 13 Input Fields will be rendered here -->
            </div>
        </div>

        <!-- Match Results Section -->
        <div class="match-results">
            <h3>Matching Results:</h3>
            <div id="matches-list" class="hidden"></div>
        </div>   
    </div>
        <div>
            <h3>Upload Bets (semicolon separated):</h3>
            <input type="file" id="file-input" accept=".txt">
        </div>     

    <script>
        let activeCombinations = [];

        // Normalize state to handle case insensitivity and wildcard matching
        function normalizeState(state) {
            return state.trim().toUpperCase(); // Case-insensitive normalization
        }

        // Handle file input and load CSV data
        document.getElementById('file-input').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                const csvContent = event.target.result;
                parseCSV(csvContent);
            };
            reader.readAsText(file);
        });

        // Parse CSV content and populate activeCombinations array
        function parseCSV(csvContent) {
            activeCombinations = [];
            const rows = csvContent.split("\n");
            rows.forEach(row => {
                const rowData = row.split(";");
                if (rowData.length === 13) {
                    activeCombinations.push(rowData);
                }
            });
            generateInputFields();
        }

        // Generate input fields for 13 states
        function generateInputFields() {
            const inputContainer = document.getElementById('input-fields');
            inputContainer.innerHTML = ''; // Clear any existing input fields

            for (let i = 0; i < 13; i++) {
                const row = document.createElement('div');
                row.classList.add('state-input-row');
                const label = document.createElement('label');
                label.textContent = `${i + 1}:`;
                row.appendChild(label);

                const inputField = document.createElement('input');
                inputField.type = 'text';
                inputField.classList.add('state-input');
                inputField.maxLength = 1; // Only one character per input
                inputField.dataset.index = i; // To track which field it corresponds to
                inputField.addEventListener('input', handleInputChange); // Update on input change
                row.appendChild(inputField);
                inputContainer.appendChild(row);
            }

            // Display results container when the user inputs a value
            document.getElementById('matches-list').classList.remove('hidden');
        }

        // Handle input change and trigger the matching function
        function handleInputChange() {
            const inputs = Array.from(document.querySelectorAll('.state-input'));
            const inputStates = inputs.map(input => normalizeState(input.value));

            // Perform matching when any input field changes
            const filteredCombinations = activeCombinations
                .map(combination => {
                    let matchCount = 0;

                    // Check each field in the combination against the user input
                    for (let i = 0; i < 13; i++) {
                        const inputState = inputStates[i];
                        const combinationState = normalizeState(combination[i]);

                        // If inputState is empty, it's a wildcard and matches any value
                        if (inputState === '' || inputState === combinationState) {
                            matchCount++;
                        }
                    }

                    // Only include rows with at least 10 matching fields
                    return matchCount >= 10 ? { combination, matchCount } : null;
                })
                .filter(row => row !== null) // Filter out rows that didn't match enough fields
                .sort((a, b) => b.matchCount - a.matchCount); // Sort by match count in descending order

            displayResults(filteredCombinations);
        }

        // Display matching results in columns next to input fields
        function displayResults(filteredCombinations) {
            const matchesList = document.getElementById('matches-list');
            matchesList.innerHTML = ''; // Clear previous results

            if (filteredCombinations.length === 0) {
                matchesList.innerHTML = "<p>No matches found.</p>";
                return;
            }

            // Create a container for results
            const resultsContainer = document.createElement('div');
            resultsContainer.classList.add('match-row');
            resultsContainer.style.display = 'flex';
            resultsContainer.style.flexDirection = 'row'; // Row for the results container

            // Create columns for 13/13, 12/13, 11/13, 10/13 matches
            const matchColumns = [[], [], [], []]; // To hold rows with specific match counts (13, 12, 11, 10)

            filteredCombinations.forEach(({ combination, matchCount }) => {
                const matchRow = document.createElement('div');
                matchRow.classList.add('state-row');

                combination.forEach((state, index) => {
                    const stateDiv = document.createElement('div');
                    const inputState = normalizeState(document.querySelectorAll('.state-input')[index].value);

                    // Highlight if the state doesn't match
                    if (inputState !== '' && normalizeState(state) !== inputState) {
                        stateDiv.classList.add('highlight');
                    }

                    stateDiv.textContent = state;
                    stateDiv.classList.add('state-cell');
                    matchRow.appendChild(stateDiv);
                });

                // Add the match count at the bottom of the row (below the last element)
                const matchCountDiv = document.createElement('div');
                matchCountDiv.textContent = `${matchCount}/13`;
                matchCountDiv.classList.add('match-count');
                matchRow.appendChild(matchCountDiv);

                // Add match row to the corresponding match count column
                if (matchCount === 13) {
                    matchColumns[0].push(matchRow);
                } else if (matchCount === 12) {
                    matchColumns[1].push(matchRow);
                } else if (matchCount === 11) {
                    matchColumns[2].push(matchRow);
                } else if (matchCount === 10) {
                    matchColumns[3].push(matchRow);
                }
            });

            // Append columns (13, 12, 11, 10 matches)
            matchColumns.forEach(column => {
                column.forEach(row => resultsContainer.appendChild(row));
            });

            matchesList.appendChild(resultsContainer);
        }
    </script>
</body>
</html>
